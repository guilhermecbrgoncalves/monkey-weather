//SELECT OPTIONS
var obj = ' { "data": [{"idRegiao": 1, "idAreaAviso": "AVR", "idConcelho": 5, "globalIdLocal": 1010500, "latitude": "40.6413", "idDistrito": 1, "local": "Aveiro", "longitude": "-8.6535"},     {"idRegiao": 1, "idAreaAviso": "BJA", "idConcelho": 5, "globalIdLocal": 1020500, "latitude": "38.0200", "idDistrito": 2, "local": "Beja", "longitude": "-7.8700"},     {"idRegiao": 1, "idAreaAviso": "BRG", "idConcelho": 3, "globalIdLocal": 1030300, "latitude": "41.5475", "idDistrito": 3, "local": "Braga", "longitude": "-8.4227"},      {"idRegiao": 1, "idAreaAviso": "BGC", "idConcelho": 2, "globalIdLocal": 1040200, "latitude": "41.8076", "idDistrito": 4, "local": "Bragan\u00e7a", "longitude": "-6.7606"},    {"idRegiao": 1, "idAreaAviso": "CBO", "idConcelho": 2, "globalIdLocal": 1050200, "latitude": "39.8217", "idDistrito": 5, "local": "Castelo Branco", "longitude": "-7.4957"},      {"idRegiao": 1, "idAreaAviso": "CBR", "idConcelho": 3, "globalIdLocal": 1060300, "latitude": "40.2081", "idDistrito": 6, "local": "Coimbra", "longitude": "-8.4194"},     {"idRegiao": 1, "idAreaAviso": "EVR", "idConcelho": 5, "globalIdLocal": 1070500, "latitude": "38.5701", "idDistrito": 7, "local": "\u00c9vora", "longitude": "-7.9104"},  {    "idRegiao": 1, "idAreaAviso": "FAR", "idConcelho": 5, "globalIdLocal": 1080500, "latitude": "37.0146", "idDistrito": 8, "local": "Faro", "longitude": "-7.9331"}, {    "idRegiao": 1, "idAreaAviso": "GDA", "idConcelho": 7, "globalIdLocal": 1090700, "latitude": "40.5379", "idDistrito": 9, "local": "Guarda", "longitude": "-7.2647"},     {"idRegiao": 1, "idAreaAviso": "LRA", "idConcelho": 9, "globalIdLocal": 1100900, "latitude": "39.7473", "idDistrito": 10, "local": "Leiria", "longitude": "-8.8069"},      {"idRegiao": 1, "idAreaAviso": "LSB", "idConcelho": 6, "globalIdLocal": 1110600, "latitude": "38.7660", "idDistrito": 11, "local": "Lisboa", "longitude": "-9.1286"},     {"idRegiao": 1, "idAreaAviso": "PTG", "idConcelho": 14, "globalIdLocal": 1121400, "latitude": "39.2900", "idDistrito": 12, "local": "Portalegre", "longitude": "-7.4200"},      {"idRegiao": 1, "idAreaAviso": "PTO", "idConcelho": 12, "globalIdLocal": 1131200, "latitude": "41.1580", "idDistrito": 13, "local": "Porto", "longitude": "-8.6294"},      {"idRegiao": 1, "idAreaAviso": "STM", "idConcelho": 16, "globalIdLocal": 1141600, "latitude": "39.2000", "idDistrito": 14, "local": "Santar\u00e9m", "longitude": "-8.7400"},     {"idRegiao": 1, "idAreaAviso": "STB", "idConcelho": 12, "globalIdLocal": 1151200, "latitude": "38.5246", "idDistrito": 15, "local": "Set\u00fabal", "longitude": "-8.8856"},             {"idRegiao": 1, "idAreaAviso": "VCT", "idConcelho": 9, "globalIdLocal": 1160900, "latitude": "41.6952", "idDistrito": 16, "local": "Viana do Castelo", "longitude": "-8.8365"},             {"idRegiao": 1, "idAreaAviso": "VRL", "idConcelho": 14, "globalIdLocal": 1171400, "latitude": "41.3053", "idDistrito": 17, "local": "Vila Real", "longitude": "-7.7440"},             {"idRegiao": 1, "idAreaAviso": "VIS", "idConcelho": 23, "globalIdLocal": 1182300, "latitude": "40.6585", "idDistrito": 18, "local": "Viseu", "longitude": "-7.9120"},              {"idRegiao": 2, "idAreaAviso": "MCS", "idConcelho": 3, "globalIdLocal": 2310300, "latitude": "32.6485", "idDistrito": 31, "local": "Funchal", "longitude": "-16.9084"},             {"idRegiao": 2, "idAreaAviso": "MPS", "idConcelho": 1, "globalIdLocal": 2320100, "latitude": "33.0700", "idDistrito": 32, "local": "Porto Santo", "longitude": "-16.3400"},             {"idRegiao": 3, "idAreaAviso": "AOR", "idConcelho": 1, "globalIdLocal": 3410100, "latitude": "36.9563", "idDistrito": 41, "local": "Vila do Porto", "longitude": "-25.1409"},             {"idRegiao": 3, "idAreaAviso": "AOR", "idConcelho": 3, "globalIdLocal": 3420300, "latitude": "37.7415", "idDistrito": 42, "local": "Ponta Delgada", "longitude": "-25.6677"},             {"idRegiao": 3, "idAreaAviso": "ACE", "idConcelho": 1, "globalIdLocal": 3430100, "latitude": "38.6700", "idDistrito": 43, "local": "Angra do Hero\u00edsmo", "longitude": "-27.2200"},            {"idRegiao": 3, "idAreaAviso": "ACE", "idConcelho": 1, "globalIdLocal": 3440100, "latitude": "39.0800", "idDistrito": 44, "local": "Santa Cruz da Graciosa", "longitude": "-28.0000"},             {"idRegiao": 3, "idAreaAviso": "ACE", "idConcelho": 2, "globalIdLocal": 3450200, "latitude": "38.6842", "idDistrito": 45, "local": "Velas", "longitude": "-28.2133"},             {"idRegiao": 3, "idAreaAviso": "ACE", "idConcelho": 2, "globalIdLocal": 3460200, "latitude": "38.5325", "idDistrito": 46, "local": "Madalena", "longitude": "-28.5237"},             {"idRegiao": 3, "idAreaAviso": "ACE", "idConcelho": 1, "globalIdLocal": 3470100, "latitude": "38.5363", "idDistrito": 47, "local": "Horta", "longitude": "-28.6315"},             {"idRegiao": 3, "idAreaAviso": "AOC", "idConcelho": 2, "globalIdLocal": 3480200, "latitude": "39.4500", "idDistrito": 48, "local": "Santa Cruz das Flores", "longitude": "-31.1300"},             {"idRegiao": 3, "idAreaAviso": "AOC", "idConcelho": 1, "globalIdLocal": 3490100, "latitude": "39.6700", "idDistrito": 49, "local": "Vila do Corvo", "longitude": "-31.1200"  } ] }';
var data = JSON.parse(obj)
let local;
function localSelect() {
    for (var i = 0; i < data["data"].length; i++) {

        local = data["data"][i]["local"]
        var node_option = document.createElement("option");                 // Create a <li> node
        node_option.setAttribute("name", "local");
        node_option.setAttribute("value", data["data"][i]["globalIdLocal"]);
        var textnode = document.createTextNode(local);         // Create a text node                  
        node_option.appendChild(textnode);
        document.getElementById("selectLocal").appendChild(node_option);
    }
}

//WEATHER TRANSLATIONS
function whatWeather(weatherId) {
    switch (weatherId) {
        case 0:
            return "No information";
            break;
        case 1:
            return "Clear Skies";
            break;
        case 2:
            return "Partly Cloudly";
            break;
        case 3:
            return "Few Clouds";
            break;
        case 4:
            return "Covered with Clouds";
            break;
        case 5:

            return "High Clouds and Covered";
            break;
        case 6:
            return "Downpours";
            break;
        case 7:
            return "Weak Downpours";
            break;
        case 8:
            return "Strong Downpours";
            break;
        case 9:
            return "Rain";
            break;
        case 10:
            return "Weak Rain or Drizzle";
            break;
        case 11:
            return "Strong Rain";
            break;
        case 12:
            return "Periods of Rain";
            break;
        case 13:
            return "Periods of Weak Rain";
            break;
        case 14:
            return "Periods of Strong Rain";
            break;
        case 15:
            return "Drizzle";
            break;
        case 16:
            return "Fog";
            break;
        case 17:
            return "Fog or Low Clouds";
            break;
        case 18:
            return "Snow";
            break;
        case 19:
            return "Thunderstorms";
            break;
        case 20:
            return "Showers and Thunderstorms";
            break;
        case 21:
            return "Hail";
            break;
        case 22:
            return "Frost";
            break;
        case 23:
            return "Rain and Thunderstorm";
            break;
        case 24:
            return "Convective Cloudiness";
            break;
        case 25:
            return "Sky with Cloudy Periods";
            break;
        case 26:
            return "Fog";
            break;
        case 27:
            return "Cloudy Sky";
            break;
    }
}

//WHAT METEO ICON AND IMG ALTS
function whatWeatherImages(weatherId, image) {
    switch (weatherId) {
        case 0:
            image.src = "img/weatherIcons/day.svg";
            image.alt = "No information"
            break;
        case 1:
            image.src = "img/weatherIcons/day.svg";
            image.alt = "Clear Skies"
            break;
        case 2:
            image.src = "img/weatherIcons/cloudy-day-2.svg";
            image.alt = "Partly Cloudly"
            break;
        case 3:
            image.src = "img/weatherIcons/cloudy-day-3.svg";
            image.alt = "Few Clouds"
            break;
        case 4:
            image.src = "img/weatherIcons/cloudy.svg";
            image.alt = "Covered with Clouds"
            break;
        case 5:
            image.src = "img/weatherIcons/cloudy-day-3.svg";
            image.alt = "High Clouds and Covered"
            break;
        case 6:
            image.src = "img/weatherIcons/rainy-1.svg";
            image.alt = "Downpours"
            break;
        case 7:
            image.src = "img/weatherIcons/rainy-2.svg";
            image.alt = "Weak Downpours"
            break;
        case 8:
            image.src = "img/weatherIcons/rainy-3.svg";
            image.alt = "Strong Downpours"
            break;
        case 9:
            image.src = "img/weatherIcons/rainy-5.svg";
            image.alt = "Rain"

            break;
        case 10:
            image.src = "img/weatherIcons/rainy-4.svg";
            image.alt = "Weak Rain or Drizzle"
            break;
        case 11:
            image.src = "img/weatherIcons/rainy-6.svg";
            image.alt = "Strong Rain"
            break;
        case 12:
            image.src = "img/weatherIcons/rainy-1.svg";
            image.alt = "Periods of Rain"
            break;
        case 13:
            image.src = "img/weatherIcons/rainy-2.svg";
            image.alt = "Periods of Weak Rain"
            break;
        case 14:
            image.src = "img/weatherIcons/rainy-3.svg";
            image.alt = "Periods of Strong Rain"
            break;
        case 15:
            image.src = "img/weatherIcons/rainy-4.svg";
            image.alt = "Drizzle"
            break;
        case 16:
            image.src = "img/weatherIcons/cloudy.svg";
            image.alt = "Fog"
            break;
        case 17:
            image.src = "img/weatherIcons/cloudy.svg";
            image.alt = "Fog or Low Clouds"
            break;
        case 18:
            image.src = "img/weatherIcons/snowy-4.svg";
            image.alt = "Snow"
            break;
        case 19:
            image.src = "img/weatherIcons/thunder.svg";
            image.alt = "Thunderstorms"
            break;
        case 20:
            image.src = "img/weatherIcons/thunder.svg";
            image.alt = "Showers and Thunderstorms"
            break;
        case 21:
            image.src = "img/weatherIcons/snowy-6.svg";
            image.alt = "Hail"
            break;
        case 22:
            image.src = "img/weatherIcons/cloudy.svg";
            image.alt = "Frost"
            break;
        case 23:
            image.src = "img/weatherIcons/thunder.svg";
            image.alt = "Rain and Thunderstorm"
            break;
        case 24:
            image.src = "img/weatherIcons/cloudy-day-2.svg";
            image.alt = "Convective Cloudiness"
            break;
        case 25:
            image.src = "img/weatherIcons/cloudy-day-3.svg";
            image.alt = "Sky with Cloudy Periods"
            break;
        case 26:
            image.src = "img/weatherIcons/cloudy.svg";
            image.alt = "Fog"
            break;
        case 27:
            image.src = "img/weatherIcons/cloudy.svg";
            image.alt = "Cloudy Sky"
            break;
    }
}

//WIND TRANSLATION
function whatWind(windId) {
    switch (windId) {
        case 0:
            return "No information";
            break;
        case 1:
            return "Weak";
            break;
        case 2:
            return "Moderate";
            break;
        case 3:
            return "Strong";
            break;
        case 4:
            return "Very Strong";
            break;
    }
}

//RANDOM DE IMAGENS
function randomImg(local, bgImg) {
    let rnd = (Math.random() * (3 - 1) + 1).toFixed(0);
    if (rnd == 1) {
        bgImg.style.backgroundImage = "url('img/locais/" + local + "1.jpg')";
    } else if (rnd == 2) {
        bgImg.style.backgroundImage = "url('img/locais/" + local + "2.jpg')";
    } else {
        bgImg.style.backgroundImage = "url('img/locais/" + local + "3.jpg')";
    }
}

//MY PLACES FUNCTIONS
function weatherCards(arr, numRows) {
    for (let i = 0; i < numRows; i++) {

        var xmlhttp = new XMLHttpRequest();
        var url = "https://api.ipma.pt/open-data/forecast/meteorology/cities/daily/" + arr[i] + ".json";

        xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

                idLocal = arr[i];

                var myArr = JSON.parse(this.responseText);

                //METEO OF TODAY
                const tMaxHoje = (myArr["data"][0])["tMax"];
                const tMinimaHoje = (myArr["data"][0])["tMin"];
                const probChuvaHoje = (myArr["data"][0])["precipitaProb"];
                const direcVentoHoje = (myArr["data"][0])["predWindDir"];
                const ventoHoje = (myArr["data"][0])["classWindSpeed"];
                const weatherIdHoje = (myArr["data"][0])["idWeatherType"];

                let imageHoje = document.getElementById("tempImgHoje_" + idLocal);
                whatWeatherImages(weatherIdHoje, imageHoje);

                //WRITE METEO OF TODAY
                document.getElementById("tempMaxHoje_" + idLocal).textContent = tMaxHoje + "ºC  ";
                document.getElementById("tempMinHoje_" + idLocal).textContent = tMinimaHoje + "ºC";
                document.getElementById("weatherType_" + idLocal).textContent = whatWeather(weatherIdHoje);
                document.getElementById("intVentoHoje_" + idLocal).textContent = "Wind intensity: " + whatWind(ventoHoje);
                document.getElementById("directVentoHoje_" + idLocal).textContent = "Wind direction: " + direcVentoHoje + "º";
                document.getElementById("chuvaHoje_" + idLocal).textContent = "Precipitation: " + probChuvaHoje + "%";

                //METEO OF NEXT DAYS
                const tMaxAmanha1 = (myArr["data"][1])["tMax"];
                const tMinimaAmanha1 = (myArr["data"][1])["tMin"];
                const weatherIdAmanha1 = (myArr["data"][1])["idWeatherType"];

                const tMaxAmanha2 = (myArr["data"][2])["tMax"];
                const tMinimaAmanha2 = (myArr["data"][2])["tMin"];
                const weatherIdAmanha2 = (myArr["data"][2])["idWeatherType"];

                const tMaxAmanha3 = (myArr["data"][3])["tMax"];
                const tMinimaAmanha3 = (myArr["data"][3])["tMin"];
                const weatherIdAmanha3 = (myArr["data"][3])["idWeatherType"];

                const tMaxAmanha4 = (myArr["data"][4])["tMax"];
                const tMinimaAmanha4 = (myArr["data"][4])["tMin"];
                const weatherIdAmanha4 = (myArr["data"][4])["idWeatherType"];

                //METEO ICONS
                let imageAmanha1 = document.getElementById("tempImgAmanha1_" + idLocal);
                let imageAmanha2 = document.getElementById("tempImgAmanha2_" + idLocal);
                let imageAmanha3 = document.getElementById("tempImgAmanha3_" + idLocal);
                let imageAmanha4 = document.getElementById("tempImgAmanha4_" + idLocal);

                //WRITE METEO NEXT DAYS
                document.getElementById("tempMaxAmanha1_" + idLocal).textContent = tMaxAmanha1 + "ºC - " + tMinimaAmanha1 + "ºC";
                whatWeatherImages(weatherIdAmanha1, imageAmanha1);
                document.getElementById("tempMaxAmanha2_" + idLocal).textContent = tMaxAmanha2 + "ºC - " + tMinimaAmanha2 + "ºC";
                whatWeatherImages(weatherIdAmanha2, imageAmanha2);
                document.getElementById("tempMaxAmanha3_" + idLocal).textContent = tMaxAmanha3 + "ºC - " + tMinimaAmanha3 + "ºC";
                whatWeatherImages(weatherIdAmanha3, imageAmanha3);
                document.getElementById("tempMaxAmanha4_" + idLocal).textContent = tMaxAmanha4 + "ºC - " + tMinimaAmanha4 + "ºC";
                whatWeatherImages(weatherIdAmanha4, imageAmanha4);
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();

        for (var j = 0; j < data["data"].length; j++) {
            if (data["data"][j]["globalIdLocal"] == arr[i]) {
                //ADICIONA NOME DE LOCAL
                document.getElementById("local_" + arr[i]).textContent = data["data"][j]["local"];
                local = data["data"][j]["local"];
                bgImg = document.getElementById('bgLocal_' + arr[i])
                randomImg(local, bgImg);
            }
        }
    }
};

var idLocal;
var myLat, myLon;
let map, infoWindow;

//HOMEPAGE FUNCTIONS
function geo() { //LOCATION OF USER
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);

    } else {
        console.log("Geolocation is not supported by this browser.");
    }
}

function showPosition(position) {
    myLat = position.coords.latitude;
    myLon = position.coords.longitude;

    var lat_1 = 0;
    var lon_1 = 0;

    for (var i = 0; i < data["data"].length; i++) {
        var temp = data["data"][i];
        lat_1 = parseFloat(temp["latitude"]).toFixed(1);
        lon_1 = parseFloat(temp["longitude"]).toFixed(0);

        if (parseFloat(myLat).toFixed(1) == lat_1 && parseFloat(myLon).toFixed(0) == lon_1) {
            idLocal = data["data"][i]["globalIdLocal"]
            local = data["data"][i]["local"]
        } else {
            console.log("Not found :(")
        }
    }
    document.getElementById("local").textContent = local;

    //RANDOM OF IMAGES
    let bgImg = document.getElementById('bgLocal')
    randomImg(local, bgImg);

    var xmlhttp = new XMLHttpRequest();
    var url = "https://api.ipma.pt/open-data/forecast/meteorology/cities/daily/" + idLocal + ".json";
    xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            var myArr = JSON.parse(this.responseText);

            //METEO OF TODAY
            const tMaxHoje = (myArr["data"][0])["tMax"];
            const tMinimaHoje = (myArr["data"][0])["tMin"];
            const probChuvaHoje = (myArr["data"][0])["precipitaProb"];
            const direcVentoHoje = (myArr["data"][0])["predWindDir"];
            const ventoHoje = (myArr["data"][0])["classWindSpeed"];
            const weatherIdHoje = (myArr["data"][0])["idWeatherType"];

            //METEO OF NEXT DAYS
            const tMaxAmanha1 = (myArr["data"][1])["tMax"];
            const tMinAmanha1 = (myArr["data"][1])["tMin"];
            const weatherIdAmanha1 = (myArr["data"][1])["idWeatherType"];
            const tMaxAmanha2 = (myArr["data"][2])["tMax"];
            const tMinAmanha2 = (myArr["data"][2])["tMin"];
            const weatherIdAmanha2 = (myArr["data"][2])["idWeatherType"];
            const tMaxAmanha3 = (myArr["data"][3])["tMax"];
            const tMinAmanha3 = (myArr["data"][3])["tMin"];
            const weatherIdAmanha3 = (myArr["data"][3])["idWeatherType"];
            const tMaxAmanha4 = (myArr["data"][4])["tMax"];
            const tMinAmanha4 = (myArr["data"][4])["tMin"];
            const weatherIdAmanha4 = (myArr["data"][4])["idWeatherType"];

            //WRITE METEO OF TODAY
            document.getElementById("tempMaxHoje").textContent = tMaxHoje + "ºC  ";
            document.getElementById("tempMinHoje").textContent = tMinimaHoje + "ºC";
            document.getElementById("weatherType").textContent = whatWeather(weatherIdHoje);
            document.getElementById("intVentoHoje").textContent = "Wind intensity: " + whatWind(ventoHoje);
            document.getElementById("directVentoHoje").textContent = "Wind direction: " + direcVentoHoje + "º";
            document.getElementById("chuvaHoje").textContent = "Precipitation: " + probChuvaHoje + "%";
            let imageHoje = document.getElementById("tempImgHoje");
            whatWeatherImages(weatherIdHoje, imageHoje);

            //METEO ICONS
            let imageAmanha1 = document.getElementById("tempImgAmanha1");
            let imageAmanha2 = document.getElementById("tempImgAmanha2");
            let imageAmanha3 = document.getElementById("tempImgAmanha3");
            let imageAmanha4 = document.getElementById("tempImgAmanha4");

            //WRITE METEO OF NEXT DAYS
            document.getElementById("tempMaxMinAmanha1").textContent = tMaxAmanha1 + " ºC - " + tMinAmanha1 + "ºC";
            whatWeatherImages(weatherIdAmanha1, imageAmanha1);
            document.getElementById("tempMaxMinAmanha2").textContent = tMaxAmanha2 + " ºC - " + tMinAmanha2 + "ºC";
            whatWeatherImages(weatherIdAmanha2, imageAmanha2);
            document.getElementById("tempMaxMinAmanha3").textContent = tMaxAmanha3 + " ºC - " + tMinAmanha3 + "ºC";
            whatWeatherImages(weatherIdAmanha3, imageAmanha3);
            document.getElementById("tempMaxMinAmanha4").textContent = tMaxAmanha4 + " ºC - " + tMinAmanha4 + "ºC";
            whatWeatherImages(weatherIdAmanha4, imageAmanha4);
        }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
}

//LOGIN PAGE
//DISPLAY&HIDE FUNCTIONS
function display(id) {
    document.getElementById(id).style.display = "block";
}

function displayNone(id) {
    document.getElementById(id).style.display = "none";
}

//PASSWORD VALIDATIONS
function repeatPassword() {
    let password = document.querySelector("#register-password1").value;
    let password2 = document.querySelector("#register-password2").value;

    if (password == password2) {
        document.getElementById('btnRegister').disabled = false;
        document.getElementById('passwordMatch').style.display = "none";
    } else {
        document.getElementById('btnRegister').disabled = true;
        document.getElementById('passwordMatch').style.display = "block";
    }
}
